{
  "name": "gitlab-server",
  "description": "Installs/Configures a Gitlab server",
  "long_description": "GitLab-Server Cookbook\n======================\n\nNeed a GitLab installation?  This cookbook has you covered.\n\n### Features:\n\n- Tested on Debian/Ubuntu and Amazon, should support others\n- Full installation including all necessary dependencies\n- Set up default users using attributes or an encrypted data bag\n- Easily customize http ports, ssl, database (use your own or let us install MySQL for you), paths, …\n\nInstallation\n------------\n\n1. Download the cookbook\n2. Run `berks install` to gather dependencies\n3. Run `berks upload` to upload to your chef-server.  We do support chef-solo, no worries!\n\nUsage\n-----\n\nWe've tried to make this remarkably simple.\n\nFor a basic install, just add `recipe[gitlab-server]` to your run list.\n\nOf course, you'll probably want to take a look at the various attributes that you can customize.  Jump in by loking at `attributes/default.rb`, which is well commented, or read the long form below.\n\nAttributes\n----------\n\n### Web Server\n\n#### Enable SSL (development)\n1. Enable the HTTPS server: `node['gitlab']['http']['secure_port'] = 443`\n2. Let us generate a self-signed SSL for you.\n3. Force-redirect to https: `node['gitlab']['http']['force_https'] = true`\n\n#### Enable SSL (production)\n1. Enable the HTTPS server: `node['gitlab']['http']['secure_port'] = 443`\n2. Use a method of your preference to install your SSL certs on the server.\n3. Point `node['gitlab']['http']['ssl_cert_path']` to your certificate and `node['gitlab']['http']['ssl_key_path']` to your private key.\n3. Force-redirect to https: `node['gitlab']['http']['force_https'] = true`\n\n#### Full set of HTTP attributes and their defaults\n- `node['gitlab']['http']['hostname'] = (fqdn)` - Your server's fully qualified domain name\n- `node['gitlab']['http']['path'] = \"/)\"` - Relative URL base, for example, specify \"/gitlab\" and your home page will be \"http://your-domain/gitlab/\"\n- `node['gitlab']['http']['port'] = \"80\"` - Bare HTTP port, set to nil to disable (i.e. you only want to run https on an obscure port)\n- `node['gitlab']['http']['secure_port'] = nil` - Secure HTTPS port, set this to enable SSL\n- `node['gitlab']['http']['force_https'] = false` - Immediately redirect bare HTTP requests to HTTPS\n- `node['gitlab']['http']['generate_ssl'] = true` - Generate a self-signed SSL certificate if none exists\n- `node['gitlab']['http']['ssl_cert_path'] = \"/etc/ssl/certs/gitlab.crt\"` - Path to SSL cert\n- `node['gitlab']['http']['ssl_key_path'] = \"/etc/ssl/private/gitlab.key\"` - Path to SSL private key\n\n### Database\n\nGitLab uses the MySQL recipe to automatically install a database for you. If you've already got a database, you probably want to override this.\n\n#### Use your own database server\n\nYou can use your own MySQL installation on another server, but still let us create a database and user for you.\n\n1. Tell GitLab-Server not to install MySQL for you: `node['gitlab']['database']['manage_install'] = false`\n2. Tell GitLab-Server your database host and root (or any user that can create databases) password:\n\t- `node['gitlab']['database']['hostname'] = \"[your hostname]\"`\n\t- Override `node['gitlab']['database']['port']` if necessary\n\t- Override `node['gitlab']['database']['root_user']` if your user is not named 'root'\n\t- `node['gitlab']['database']['root_password'] = \"[your database root password]\"`\n3. Customize the name of the database and user the cookbook will create:\n\t- `node['gitlab']['database']['database'] = \"gitlabhq_production\"`\n\t- `node['gitlab']['database']['username'] = \"gitlab\"`\n\n#### Use an existing database on your own server\n\n1. Tell GitLab-Server not to install MySQL for you: `node['gitlab']['database']['manage_install'] = false`.\n2. Tell GitLab-Server not to create a database for you: `node['gitlab']['database']['manage_database'] = false`.\n2. Tell GitLab-Server your database host:\n\t- `node['gitlab']['database']['hostname'] = \"[your hostname]\"`\n\t- Override `node['gitlab']['database']['port']` if necessary\n3. Provide us the database name and a user with permission to it:\n\t- `node['gitlab']['database']['database'] = \"[database name]\"`\n\t- `node['gitlab']['database']['username'] = \"[username]\"`\n\t- `node['gitlab']['database']['password'] = \"[password]\"`\n\n### App Settings\n\n#### Email Addresses\n- `node['gitlab']['app']['system_email']` - System email address (notifications come from this)\n- `node['gitlab']['app']['support_email']` - Support email address displayed to users\n\n#### Default Users\n\nWe offer a lot of ways to set up default users.\n\n##### Default Admin User:\n- `node['gitlab']['admin']['enable'] = true` - Disable if you don't want a default admin created (i.e. you're using one of the more flexible methods below)\n- `node['gitlab']['admin']['username'] = \"root\"` - Username\n- `node['gitlab']['admin']['name'] = \"Administrator\"` - Full name\n- `node['gitlab']['admin']['email'] = \"admin@local.host\"` - Email Address\n- `node['gitlab']['admin']['password'] = \"5iveL!fe\"` - Password\n\n##### Using Default User Providers\n\nGitLab-Server can create users from several sources.  These users are only used when initializing the database—they cannot be used to add users after the fact.\n\nBasic format for the User object:\n\n    {\n      \"id\": \"lucas\",\n      \"name\": \"Lucas Christian\",\n      \"email\": \"lucas@lucasec.com\",\n      \"password\": \"SuperSecurePassword\",\n      \"admin\": true,\n      \"limit\": 100,\n      \"keys\": [\n        { \"title\": \"[ssh key name here]\", \"key\": \"[paste ssh key here]\" },\n        { \"title\": \"[ssh key name 2 here]\", \"key\": \"[paste ssh key 2 here]\" }\n      ]\n    }\n \n\n###### Encrypted Data Bag (best)\n\nEncrypted Data Bags allow you to securely store a set of default usernames, passwords, and even SSH Keys!\n\nTo get started, set the following attribute and then follow the steps below to create your data bag: `node['gitlab']['default_users'] = {:type => \"data bag\", :name => \"gitlab_users\", :encrypted => true}`\n\nEDB Quick Start:\n\n1. Change to your chef_repo/.chef directory.\n2. Generate a secret key `openssl rand -base64 512 > encrypted_data_bag_secret`\n3. Tell knife.rb about your secret so it will push it out during bootstraps: `echo \"encrypted_data_bag_secret '.chef/encrypted_data_bag_scret'\" > knife.rb`\n4. Make your first user: `knife data bag create gitlab_users [new username here] --secret-file=encrypted_data_bag_secret`\n5. Enter the user's info into your text editor (see the format spec above), save, and close\n6. Done!  Start at step 4 to add additional users.\n\nYou can customize this behavior a bit:\n\n- Use a different data bag name: `node['gitlab']['default_users'] = {:type => \"data bag\", :name => \"[data bag name here]\", :encrypted => true}`\n- Use a non-default encryption key: `{:type => \"data bag\", :name => \"data bag name\", :encrypted => true, :secret_file => \"path-to-secret-key\"}`\n\n###### Regular Data Bag\n\nYou can use a regular (non-encrypted) data bag as well.  Just set `:encrypted => false`.\n\n###### JSON Attribute\n\nYou can also provide an array of default users in the attributes.  This approach can be used with chef-solo.\n\nHere's how: `node['gitlab']['default_users'] = {:type => \"json\", :data => [array of users (see format above)]}`\n\n### System Settings\n\n#### Repository Path\n\nYou can specify a custom directory for the repositories folder.  This may be useful if you want to store the folder on a separate volume.\n\n- `node['gitlab']['app']['repo_path'] = \"(home dir)/repositories\"` - Repository folder.  This folder will be created if it does not exist, and permissions will be adjusted automatically.\n\n#### Automatic Backups\n\nGitLab-Server can run automatic backups for you using cron.\n\nBackups are configured by default to be saved in `(home dir)/backups` and kept for 30 days.  Of course, you can change this.\n\n- `node['gitlab']['backup']['path'] = \"(home dir)/backups\"` - The folder that GitLab will store backups in.\n-  `node['gitlab']['backup']['keep_for'] = '30d'` - How long backups should be kept.  Use this friendly syntax: `10d 12h 5m` would run backups every 10 days, 12 hours, and 5 minutes.  No calculator necessary.\n\nBackups can be run at any time by running `service gitlab backup` as root.  You can also schedule this using cron.\n\n- `node['gitlab']['backup']['run'] = \"manually\"` - Specify when the backup should run.  This can either be set to \"manually\" or a crontab-style time string (min hour day month weekday).  For example, `0 0 * * *` will run the job daily (at the zero hour and zero minute).\n\n#### System User\n\nYou can configure the system user that GitLab runs under.  Chef will make this user if it does not exist.\n\n- `node['gitlab']['system_user']['name'] = \"git\"` - System user name\n- `node['gitlab']['system_user']['group'] = \"git\"` - System group used for all GitLab files and the user\n- `node['gitlab']['system_user']['home_dir'] = \"(platform specific)\"` - Home Directory path\n- `node['gitlab']['system_user']['shell'] = \"(platform specific)\"` - Shell executable\n\nNotes\n-----\n\nGitLab-Server uses the Nginx cookbook.  By default, it will create its own site and *disable the default site*.  If you want to override this behavior, just sepcify `node['nginx']['default_site_enabled'] = true`.\n\nBuild-essential is set to run at complie time in order to satisfy the MySQL cookbook.  If your attributes override this, the run may fail.\n\n### Chef-Solo Usage\n\nGitLab-Server works fine with Chef-Solo, except the recipe cannot use automatic password generation when setting up a database for you. Make sure you give us a password in your JSON:\n\n    {\n      \"gitlab\": {\n        \"database\": {\n          \"password\": \"[your secure password here]\"\n        }\n      }\n    }\n\nRoadmap\n-------\n\nWe've got a few features planned:\n\n- Spliting main recipe into smaller recipes\n- GitLab CI recipe\n\nLicense and Authors\n-----------------\n\nCopyright 2013, Lucas Christian\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n",
  "maintainer": "Lucas Christian",
  "maintainer_email": "lucas@lucasec.com",
  "license": "Apache 2.0",
  "platforms": {
    "debian": [

    ],
    "centos": [

    ],
    "ubuntu": [

    ],
    "redhat": [

    ],
    "amazon": [

    ]
  },
  "dependencies": {
    "redisio": ">= 0.0.0",
    "openssl": ">= 0.0.0",
    "rvm": ">= 0.0.0",
    "python": ">= 0.0.0",
    "git": ">= 0.0.0",
    "build-essential": ">= 0.0.0",
    "database": ">= 0.0.0",
    "mysql": ">= 0.0.0",
    "nginx": ">= 0.0.0",
    "yum": ">= 0.0.0"
  },
  "recommendations": {
  },
  "suggestions": {
  },
  "conflicting": {
  },
  "providing": {
  },
  "replacing": {
  },
  "attributes": {
  },
  "groupings": {
  },
  "recipes": {
  },
  "version": "1.0.0"
}